# Blogicum - Приложение «Блогикум». Часть 2. Публикации

## Как устроен Блогикум
Главное в блоге — это публикация («пост»), вокруг неё всё и строится. 
У каждой публикации на проекте должны быть такие атрибуты:
- Заголовок поста.
- Основной текст поста.
- Дата публикации. Автор поста (или суперпользователь) могут установить любую дату публикации, в том числе — ещё не наступившую, в будущем.
- Дата добавления публикации в базу данных.
- Флаг «опубликовано».
- Автор: зарегистрированный на проекте пользователь. Авторов могут добавлять суперпользователи.
- Локация: одно определённое местоположение, к которому относится пост; локация может быть не указана, тогда на уровне шаблона в качестве локации отображается значение «Планета Земля».
- Категория: подборка, в которой собраны посты по определённой теме.

Логика работы проекта
1. Без указания какой-либо одной категории новый пост добавить нельзя.
2. Локацию для поста указывать необязательно.
3. Администратор сайта может снять с публикации любой пост, категорию и локацию.

Пост отображается на страницах проекта, если у него одновременно:
- дата публикации — не позже текущего времени,
- он опубликован,
- категория, к которой он принадлежит, не снята с публикации;

Локация, снятая с публикации, не влияет на отображение связанных с ней постов.

## Подготовка к выполнению задания:

Клонируйте репозиторий django_sprint3 на свой компьютер в рабочую папку Dev/.
Скопируйте выполненное домашнее задание прошлого спринта из директории django_sprint1/blogicum/ в папку django_sprint3/blogicum/.
Разверните и активируйте виртуальное окружение в папке Dev/django_sprint3/, установите в него зависимости из requirements.txt.
После установки проекта должна получиться такая структура файлов:
```tree
Dev/
 └── django_sprint3/
     ├── .vscode/    Служебная папка редактора кода (опционально, скрытая)
     ├── .git/       Служебная информация Git (скрытая)
     ├── templates/     <-- ШАБЛОНЫ для выполнения задания  
     ├── tests/             Тесты Практикума, проверяющие проект
     ├── venv/              Директория виртуального окружения
     ├── blogicum/          <-- Директория проекта
     |   ├── blog/
     |   ├── pages/
     |   ├── static/
     |   ├── templates/     <-- Перенесите новые шаблоны сюда 
     |   ├── blogicum/
     |   ├── db.sqlite3     Файл базы данных (может и не быть)
     |   └── manage.py
     ├── .flake8            Настройки тестов Практикума (скрытый) 
     ├── .gitignore         Список файлов и папок, скрытых от отслеживания Git (скрытый) 
     ├── db.json            <-- Фикстуры для базы данных    
     ├── LICENSE            Лицензия   
     ├── pytest.ini         Конфигурация тестов Практикума
     ├── README.md          Описание проекта 
     └── requirements.txt   Список зависимостей проекта 
```

## Задание

Первым делом удалите из файла blog/views.py словарь posts. Он больше не понадобится, дальше будем работать по-настоящему, с базой данных.
Создайте модели проекта

В приложении blog потребуются следующие модели:
- Post (Публикация)
- Category (Тематическая категория)
- Location (Географическая метка)
- User (Пользователь, эту модель описывать не нужно, она встроена в Django)

Данные для описания моделей:

### Post (Публикация)
| Название поля | Тип поля                                                                                        | Описание                                        | Обязательное? |
| ------------- | ----------------------------------------------------------------------------------------------- | ----------------------------------------------- | ------------- |
| title         | Строка                                                                                          | Максимальная длина строки — 256 символов        | Да            |
| text          | Текст                                                                                           |                                                 | Да            |
| pub_date      | Дата, время                                                                                     |                                                 | Да            |
| author        | FK, связь с моделью User. Один User может быть связан с несколькими публикациями                | Каскадное удаление связанных объектов           | Да            |
| location      | FK, связь с моделью Location. Один объект Location может быть связан с несколькими публикациями | Установить NULL при удалении связанных объектов | Нет           |
| category      | FK, связь с моделью Category. К одной категории может принадлежать несколько публикаций         | Установить NULL при удалении связанных объектов | Да            |
| is_published  | Булево значение                                                                                 | Значение по умолчанию — True                    | Да            |
| created_at    | Дата, время                                                                                     | Добавляется автоматически                       | Да            |

### Category (Тематическая категория)
| Название поля | Тип поля        | Описание                                 | Обязательное? |
| ------------- | --------------- | ---------------------------------------- | ------------- |
| title         | Строка          | Максимальная длина строки — 256 символов | Да            |
| description   | Текст           |                                          | Да            |
| slug          | Slug            | Уникальное значение                      | Да            |
| is_published  | Булево значение | Значение по умолчанию — True             | Да            |
| created_at    | Дата, время     | Добавляется автоматически                | Да            |

### Location (Географическая метка)

| Название поля | Тип поля        | Описание                                | Обязательное? |
| ------------- | --------------- | --------------------------------------- | ------------- |
| name          | Строка          | Максимальная длина строки —256 символов | Да            |
| is_published  | Булево значение | Значение по умолчанию — True            | Да            |
| created_at    | Дата, время     | Добавляется автоматически               | Да            |

Модель User встроена в Django и готова к работе. Сослаться на неё из другой модели можно так:


```python
from django.contrib.auth import get_user_model

User = get_user_model()
...

class Post(models.Model):
    author = models.ForeignKey(
        User,
        on_delete=models.CASCADE           
    )
```

Когда структура базы данных будет готова, загрузите фикстуры из файла db.json.
### Настройте панель администратора
Настройте админ-зону проекта так, чтобы можно было управлять созданием, изменением и удалением объектов моделей:
- Category
- Location
- Post

Переключите панель администратора на русскую локализацию и укажите обозначения на русском языке:
- Название приложения Blog переведите на русский: «Блог»
- Переведите названия моделей:

| Название модели | Единственное число | Множественное число |
| --------------- | ------------------ | ------------------- |
| Category        | категория          | Категории           |
| Location        | местоположение     | Местоположения      |
| Post            | публикация         | Публикации          |

- Переведите названия атрибутов моделей:

| Название поля | Перевод                 |
| ------------- | ----------------------- |
| is_published  | Опубликовано            |
| title         | Заголовок               |
| slug          | Идентификатор           |
| description   | Описание                |
| pub_date      | Дата и время публикации |
| text          | Текст                   |
| author        | Автор публикации        |
| category      | Категория               |
| location      | Местоположение          |
| created_at    | Добавлено               |
| name          | Название места          |

- Добавьте тексты-подсказки к полям:

| Название поля | Подсказка                                                                                 |
| ------------- | ----------------------------------------------------------------------------------------- |
| is_published  | Снимите галочку, чтобы скрыть публикацию.                                                 |
| slug          | Идентификатор страницы для URL; разрешены символы латиницы, цифры, дефис и подчёркивание. |
| pub_date      | Если установить дату и время в будущем — можно делать отложенные публикации.              |

## Шаблоны
Новые HTML-шаблоны с вёрсткой лежат в папке templates. Перенесите их в соответствующую папку проекта (старые шаблоны удалите или сохраните где-нибудь вне проекта).
```tree
Dev/
 └── django_sprint3/
     ├── .vscode/    
     ├── .git/       
     ├── templates/     <-- Взять шаблоны тут.   
     ├── tests/            
     ├── venv/              
     ├── blogicum/            
     |   ├── blog/
     |   ├── pages/
     |   ├── static/
     |   ├── templates/   <-- Очистить эту папку и положить в неё новые шаблоны.
     |   ├── blogicum/
     |   ├── db.sqlite3 
     |   └── manage.py
     ├── .flake8
     ├── .gitignore         
     ├── LICENSE            
     ├── pytest.ini         
     ├── README.md          
     └── requirements.txt    
```

В HTML-шаблонах, в тегах `{{ }}` указано, какая информация должна быть выведена в каждом конкретном месте шаблона. 

### View-функции и запросы к БД
Обновите код view-функций: настройте ORM-запросы так, чтобы на страницы проекта выводилась требуемая информация.

### Содержимое страниц
#### Главная страница проекта
Выводятся пять последних публикаций. 
На главной странице должны показываться только те публикации, у которых одновременно:
- дата публикации — не позже текущего времени,
- значение поля is_published равно True,
- у категории, к которой принадлежит публикация, значение поля is_published равно True.
#### Страница категории
Выводятся только те публикации, которые 
- принадлежат выбранной категории,
- значение поля is_published равно True,
- дата публикации — не позже текущего времени.
Если у запрошенной категории значение поля is_published равно False — должна возвращаться ошибка 404.

#### Страница отдельной публикации
Выводится отдельная публикация, полученная по первичному ключу. 
Запрос к странице публикации должен вернуть ошибку 404, если: 
- дата публикации — позже текущего времени
- или значение поля is_published у запрошенной публикации равно False,
- или у категории, к которой принадлежит публикация, значение поля is_published равно False.

## Проверка
После выполнения задания: 
Запустите тесты локально, на компьютере. В активированном виртуальном окружении через терминал из папки Dev/django_sprint3 выполните команду pytest.

Если все тесты пройдены успешно, то можно отправлять проект на GitHub. Структура папок в вашем репозитории должна быть такой:
```tree
django_sprint3/
  ├── tests/             Тесты Практикума, проверяющие проект
  ├── blogicum/     <--  Рабочая папка с вашим кодом
  ├── .flake8            Настройки тестов Практикума
  ├── .gitignore         Список файлов и папок, скрытых от отслеживания Git
  ├── LICENSE            Лицензия
  ├── pytest.ini         Конфигурация тестов Практикума
  ├── README.md          Описание проекта 
  └── requirements.txt   Зависимости проекта 
```
Отправьте задание на проверку. На странице урока с заданием нажмите кнопку «Проверить задание». На учебной платформе запустятся автоматические тесты, которые проверят ваше задание.

#### Возможные проблемы при отправке проекта на проверку

### Проблемы общего характера

1. **Тесты локально проходят, а на платформе выдают ошибку.**
    - Убедитесь, что проект написан с использованием возможностей Python 3.10. Тесты также должны запускаться именно на этой версии Python.
    - Возможно, локальная версия тестов на вашем компьютере отличается от тестов на платформе (тесты на платформе периодически обновляют или вы, возможно, случайно изменили тесты локально).
        
        Актуальные тесты всегда можно взять из аккаунта Яндекс Практикума: [https://github.com/yandex-praktikum/django_sprint3/](https://github.com/yandex-praktikum/django_sprint3/)
        
    - Проверьте, что в _.gitignore_ не добавлены файлы, от которых зависит запуск проекта (например, _pytest.ini_).
    - Убедитесь, что все приложения проекта добавлены в `INSTALLED_APPS` в файле _settings.py_.
    - Убедитесь, что в репозитории есть все миграции.
    - Убедитесь, что все файлы с кодом проекта включены в коммит и попали в репозиторий. Не добавляйте в репозиторий папки _pip_, _venv_, _static/css_.
    - Проверьте регистр названий папок и файлов (Git может не увидеть изменение регистра имени файла или папок). Команда `git config core.ignorecase false` сделает Git чувствительным к регистру. [Информация по настройке есть здесь](https://stackoverflow.com/questions/52950/how-to-make-git-ignore-changes-in-case).
2. **Проект не загружается на платформу.**
    - Проверьте, не переименован ли репозиторий. Репозиторий этого задания должен называться _django_sprint3._
    - Проверьте, что актуальная версия проекта находится в ветке _master_ или _main_.
    - Если вы загружали проект ZIP-архивом — проблема может быть в том, что формат архива не соответствует формату GitHub.  
        Если архив не хочет загружаться на платформу — создайте архив средствами GitHub: в интерфейсе репозитория есть кнопка **Download ZIP**. Нажав на неё, вы получите архив, который загрузится на платформу без проблем.  
        
        ![](https://pictures.s3.yandex.net/resources/S2_08_05_1679566015.png)
        

### Что делать, если в репозиторий попали лишние файлы:

Если в репозитории на удалённом сервере окажется что-то лишнее (например, папки виртуального окружения или служебные папки редактора кода), воспользуйтесь этим алгоритмом (на примере _.vscode_):

```bash
# Добавить папку в игнор-лист гита
# командой из корневой директории проекта Dev/django_sprint3/
echo '.vscode' >> .gitignore
 
# Удалить папку из списка отслеживаемых файлов (staging area).
git rm -r --cached .vscode
 
# Зафиксировать изменения в новом коммите.
git commit -m 'Директория .vscode добавлена в gitignore'
 
# Отправить изменения. 
git push 
```

[  
](https://practicum.yandex.ru/learn/associated-programs-backend-st/courses/0e3832a9-81da-424f-83b0-61b7280833af/sprints/403027/topics/7fd0f9ad-4899-4006-b78a-c05e78b3979b/lessons/68c5d828-ec05-4c31-994a-ccd74d9b42cd/)
